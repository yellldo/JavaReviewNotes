## ConCurrentHashMap

> 1.8 是通过cas和synchronize保证线程安全的
> 1.7 是分段锁  
> 判断sizeCtrl，


> 为0表示为初始化  
> 为-1.表示正在初始化  
> 小于0，并且不是-1表示正在扩容

### 转树

> 元素个数大于8时，数组长度小于64会扩容，否则会转树（加锁）

### put

- 根据key计算hashcode
- 判断是否需要进行初始化。
- 数组桶为空，则初始化（cas+自旋）
- 桶内为空，就添加元素（cas尝试写入，失败则自旋保证成功，成功后break）
- 如果发现正在扩容，就帮助扩容
- 以上都不满足，利用synchronized锁写入数据
- 如果数量大于 **TREEIFY_THRESHOLD**，则要执行树化方法，在treeifyBin中会首先判断当前数组长度≥64时才会将链表转换为红黑树。
