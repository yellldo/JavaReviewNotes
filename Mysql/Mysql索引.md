## 索引

> 可以提高数据查询的效率，索引是在存储引擎层实现的<br>
> 索引使用的数据结构是B+树

- 索引类型分为主键索引和非主键索引
  > 主键索引的叶子节点存的是整行数据，在Innodb里，主键索引也叫聚簇索引
  > 非主键索引存的叶子节点内容是主键的值， 在Innodb里，非主键索引也叫二级索引

- 基于主键索引和普通索引的查询有什么区别？
  > 主键索引查询方式，只需要搜索id这棵索引树
  > 普通索引查询方式，需要先搜索普通索引树，得到id，再到id索引树查询一遍。这个过程叫做回表

## 索引维护

- 插入新值的时候需要维护B+树，如果新的行id比最大的id要大，就直接在记录后面插入一个新纪录，如果新插入的id在中间，就需要逻辑上挪动后面的数据，空出位置。
  当数据页满了，就需要申请一个新的数据页，这个过程叫做页分裂。这种情况下，性能会受到影响。


- 除性能外，页分裂操作还影响数据页的利用率。原本放在一个页的数据，现在分到两个页中，整体空间利用率降低大约 50%。


- 反之，相邻两个数据页删除了数据，利用率很低之后，会将数据页合并。合并的过程，可以认为是分裂过程的逆过程。

### 覆盖索引

> 查询语句中查询结果字段中包含主键列，查询结果可以直接返回，不需要回表，这个过程叫做覆盖索引。<br>
> 由于覆盖索引可以减少树的搜索次数，显著提升查询性能，所以使用覆盖索引是一个常用的性能优化手段。

### 最左前缀原则

![avatar](../pics/89f74c631110cfbc83298ef27dcd6370.webp)
> 索引项是按照索引定义里面出现的字段顺序排序的。

#### 创建联合索引

- 第一原则是，如果通过调整顺序，可以少维护一个索引，那么这个顺序往往就是需要优先考虑采用的。
- 二就是要考虑空间问题。

### 索引下推

> MySQL 5.6 引入的索引下推优化（index condition pushdown)， 可以在索引遍历过程中，对索引中包含的字段先做判断，直接过滤掉不满足条件的记录，减少回表次数。





